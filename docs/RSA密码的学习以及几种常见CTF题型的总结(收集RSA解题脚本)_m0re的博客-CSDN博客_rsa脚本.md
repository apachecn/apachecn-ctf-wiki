<!--yml
category: æœªåˆ†ç±»
date: 2022-04-26 14:36:28
-->

# RSAå¯†ç çš„å­¦ä¹ ä»¥åŠå‡ ç§å¸¸è§CTFé¢˜å‹çš„æ€»ç»“(æ”¶é›†RSAè§£é¢˜è„šæœ¬)_m0reçš„åšå®¢-CSDNåšå®¢_rsaè„šæœ¬

> æ¥æºï¼š[https://blog.csdn.net/qq_45836474/article/details/105279838](https://blog.csdn.net/qq_45836474/article/details/105279838)

# æ”¾åœ¨æœ€å‰é¢

å¤§å¸ˆå‚…åšå®¢
[ä»æ•°ç›²åˆ°å£ç®— â€”â€”å¸¦ä½ ç©è½¬RSAåŠ å¯†ç®—æ³•ï¼ˆä¸€ï¼‰](https://www.freebuf.com/column/148185.html)
[ä½ æƒ³è¦çš„RSAè§£é¢˜æŠ€å·§ï¼ˆäºŒï¼‰](https://www.freebuf.com/column/148898.html)
å‰è¨€ï¼šgmpy2åº“ç»ˆäºå®‰è£…å¥½äº†ï¼Œé‚£å°±èƒ½å¼€å¿ƒçš„ç©è€äº†ã€‚
ä¸€ä¸ªå¹³å°ä¸€ä¸ªå¹³å°çš„â€œæ‰«è¡â€
RSAè¿™ç±»é¢˜çœŸæ˜¯æ¯æ¬¡çœ‹è§éƒ½ç€æ€¥ï¼Œå­¦è„šæœ¬å§ï¼Ÿä½†æ˜¯åˆæ²¡æœ‰gmpy2ã€‚æ— å¥ˆï¼Œç°åœ¨ç»ˆäºæœ‰äº†ï¼Œæˆ‘è¦æŠŠä¹‹å‰æ¯å†™å‡ºæ¥çš„é¢˜æ‰«ä¸€éã€‚
å…³äºRSAçš„è¿™ä¸ªå¯†ç ã€‚æ•°å­¦é€»è¾‘æ¯”è¾ƒâ€¦â€¦é‚£å•¥ä¸€ç‚¹ï¼Œè·Ÿç€Bç«™ä¸Šçš„ä¸€ä¸ªupä¸»å­¦çš„ï¼Œè®²çš„æŒºå¥½ï¼Œå¬ç€å¬ç€ç¡ç€äº†ã€‚è®©æˆ‘æ‰¾åˆ°äº†é«˜ä¸­çš„æ„Ÿè§‰ã€‚è·‘é¢˜äº†ï¼Œï¼Œå’³å’³ã€‚å½“ç„¶è¿˜æœ‰å¸ˆå‚…ä»¬çš„åšå®¢æä¾›å­¦ä¹ å¸®åŠ©ã€‚

# RSAå¯†ç åŸç†

![æ¥è‡ªæ¼æ–—ç¤¾åŒº](img/a28c66f93489b9295d36721df0a4c9cb.png)
æ•°å­¦çŸ¥è¯†ï¼š
é¦–å…ˆï¼šå–æ¨¡è¿ç®—çŸ¥è¯†ï¼Œå°±æ˜¯å–ä½™æ•°ã€‚å¯ä»¥ä½¿ç”¨pythonçš„powå‡½æ•°æ¥è§£
powçš„è§£æ³•å¦‚ä¸‹ï¼š

![Augenstern](img/c7631c65fe922e91fd92bdc7ac7c086d.png)
å…¶æ¬¡ï¼šåŒä½™è¿ç®—ã€‚ä¸¤ä¸ªæ•´æ•°a,bï¼Œå®ƒä»¬é™¤ä»¥æ•´æ•°Mæ‰€å¾—çš„ä½™æ•°ç›¸ç­‰ï¼ša â‰¡ b(mod m)ï¼Œæ¯”å¦‚è¯´5é™¤3ä½™æ•°ä¸º2ï¼Œ11é™¤3ä½™æ•°ä¹Ÿä¸º2ï¼Œäºæ˜¯å¯å†™æˆ11 â‰¡ 5(mod 3)ã€‚
RSAåŠ å¯†ç®—æ³•ï¼š
ä¸€ä¸ªåŸç†å›¾ï¼Œä»æ¼æ–—ç¤¾åŒºå€Ÿé‰´çš„
![æ¥è‡ªæ¼æ–—ç¤¾åŒº](img/06b0b4adc5a7888ed1c275351f0c53ac.png)
![æ¥è‡ªæ¼æ–—ç¤¾åŒº](img/b9677526ef9de4d1e1f4b9eeb73286a9.png)
è¿™ä¸¤å¼ å›¾å¯¹äºç†è§£rsaåŠ å¯†å¾ˆæœ‰å¸®åŠ©ï¼Œæˆ‘ä»è¿™ä¸¤å¼ å›¾ä¸­ç†è§£åæ€è·¯å˜çš„æ›´æ¸…æ™°äº†ã€‚
è¿˜æœ‰ä¸€å¼ è§£æCTFä¸­çš„rsaåŸºç¡€é¢˜å‹çš„å›¾ã€‚å£°æ˜ï¼šæ˜¯æ¼æ–—ç¤¾åŒºçš„å¸ˆå‚…å†™çš„ï¼Œæˆ‘åªæ˜¯æ¬è¿‡æ¥åšä¸ªç¬”è®°ï¼Œæ–¹ä¾¿ä»¥åæŸ¥è¯¢ä½¿ç”¨ã€‚
![æ¥è‡ªæ¼æ–—ç¤¾åŒº](img/2163bf207d966dc5d2a93aaace36d3c3.png)
åšå‡ ä¸ªç±»å‹çš„é¢˜ç›®è®°å½•ä¸€ä¸‹ï¼Œé˜²æ­¢ä»¥åå¿˜è®°æ–¹ä¾¿å¤ä¹ ã€‚

# BUUCTF

## RSA

![Augenstern](img/54160a75ef0dd9821c24405d083f0c09.png)
è¿™é“é¢˜æ˜¯ä¸€ç§ç±»å‹ï¼Œå·²çŸ¥p,q,eï¼Œæ±‚d
å¯ä»¥ç”¨æ±‚dçš„è„šæœ¬ç›´æ¥è§£å‡ºï¼Œè¿è¡Œè„šæœ¬éœ€è¦ç”¨åˆ°gmpy2ç¬¬ä¸‰æ–¹åº“ã€‚
ç›´æ¥ä¸Šè„šæœ¬

```
 import gmpy2
from Crypto.Util import number
p = 473398607161
q = 4511491
e = 17
d = gmpy2.invert(e,(p-1)*(q-1))
print (d) 
```

flag{125631357777427553}

## rsarsa

![Augenstern](img/d1e03150f780b68722f0a478b105e337.png)
è„šæœ¬å…³ã€‚

```
import gmpy2
def Decrypt(c,e,p,q):
	L=(p-1)*(q-1)
	d=gmpy2.invert(e,L)
	n=p*q
	m=gmpy2.powmod(c,d,n)
	flag=str(m)
	print("flag{"+flag+"}")
if __name__ == '__main__':
	p =  9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483
	q =  11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407
	e =  65537
	c =  83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034
	Decrypt(c,e,p,q) 
```

æ³¨é‡Šï¼š
`__name__=='__main__'`ä¸€ä¸ªpythonæ–‡ä»¶é€šå¸¸æœ‰ä¸¤ç§ä½¿ç”¨æ–¹æ³•ï¼Œ
ç¬¬ä¸€æ˜¯ä½œä¸ºè„šæœ¬ç›´æ¥æ‰§è¡Œï¼Œ
ç¬¬äºŒæ˜¯ import åˆ°å…¶ä»–çš„ python è„šæœ¬ä¸­è¢«è°ƒç”¨ï¼ˆæ¨¡å—é‡ç”¨ï¼‰æ‰§è¡Œã€‚å› æ­¤ `if __name__ == 'main':` çš„ä½œç”¨å°±æ˜¯æ§åˆ¶è¿™ä¸¤ç§æƒ…å†µæ‰§è¡Œä»£ç çš„è¿‡ç¨‹ï¼Œåœ¨ `if __name__ == 'main':` ä¸‹çš„ä»£ç åªæœ‰åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼ˆå³æ–‡ä»¶ä½œä¸ºè„šæœ¬ç›´æ¥æ‰§è¡Œï¼‰æ‰ä¼šè¢«æ‰§è¡Œï¼Œè€Œ import åˆ°å…¶ä»–è„šæœ¬ä¸­æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ï¼Œå¿˜äº†å°±å†çœ‹çœ‹å¤§ä½¬çš„åšå®¢[å¤§ä½¬åšå®¢](https://blog.csdn.net/heqiang525/article/details/89879056)
flagå…¶ä»–æ²¡ä»€ä¹ˆäº†ã€‚flagç›´æ¥å¾—åˆ°ã€‚

## RSA1

![Augenstern](img/cd29807fb4ed7586e977f930d1c5bbdc.png)
å…¶å®é€šè¿‡è¿™é“é¢˜æˆ‘å­¦åˆ°å¾ˆå¤šï¼Œä¸€ç‚¹ä¸€ç‚¹çœ‹

```
dp=d%(p-1)
dq=d%(q-1) 
```

è¿™ä¸ªè„šæœ¬ä¸ä¼šå†™ï¼Œæˆ‘åªä¼šå†™é‚£ç§å¼‚å¸¸çš„ç®€å•çš„å°è„šæœ¬ï¼Œè¿™ç§ä¸ä¼šå†™ã€‚æœ¬äººè„¸çš®åšå½“ä¸ªscript boyã€‚ğŸ˜ªğŸ˜ª

```
import gmpy2
import libnum
def decrypt(dp,dq,p,q,c):
    InvQ = gmpy2.invert(q, p)
    mp = pow(c, dp, p)
    mq = pow(c, dq, q)
    m = (((mp-mq)*InvQ) % p)*q+mq
    print (libnum.n2s(m))

p = 8637633767257008567099653486541091171320491509433615447539162437911244175885667806398411790524083553445158113502227745206205327690939504032994699902053229 
q = 12640674973996472769176047937170883420927050821480010581593137135372473880595613737337630629752577346147039284030082593490776630572584959954205336880228469 
dp = 6500795702216834621109042351193261530650043841056252930930949663358625016881832840728066026150264693076109354874099841380454881716097778307268116910582929 
dq = 783472263673553449019532580386470672380574033551303889137911760438881683674556098098256795673512201963002175438762767516968043599582527539160811120550041 
c = 24722305403887382073567316467649080662631552905960229399079107995602154418176056335800638887527614164073530437657085079676157350205351945222989351316076486573599576041978339872265925062764318536089007310270278526159678937431903862892400747915525118983959970607934142974736675784325993445942031372107342103852
decrypt(dp,dq,p,q,c) 
```

ç»“æœå¾—åˆ°ï¼š
![Augenstern](img/8f3c9cf5ad0050366fa56f524bddca4f.png)

## RSA2

![Augenstern](img/3c36abc2bdb5014b5c43aeb52f29f866.png)
çŸ¥é“dpï¼Œnï¼Œe;æ±‚æ˜æ–‡m.ï¼Œæˆ‘è¿˜æ˜¯ä¸ä¼šå†™è„šæœ¬ï¼Œç°åœ¨æ‰å‘ç°æˆ‘è¿™ç¯‡åšå®¢å°±æ˜¯ç”¨æ¥æ”¶é›†è„šæœ¬çš„ã€‚

```
import gmpy2 as gp

e = 65537
n = gp.mpz(248254007851526241177721526698901802985832766176221609612258877371620580060433101538328030305219918697643619814200930679612109885533801335348445023751670478437073055544724280684733298051599167660303645183146161497485358633681492129668802402065797789905550489547645118787266601929429724133167768465309665906113)
dp = gp.mpz(905074498052346904643025132879518330691925174573054004621877253318682675055421970943552016695528560364834446303196939207056642927148093290374440210503657)

c = gp.mpz(140423670976252696807533673586209400575664282100684119784203527124521188996403826597436883766041879067494280957410201958935737360380801845453829293997433414188838725751796261702622028587211560353362847191060306578510511380965162133472698713063592621028959167072781482562673683090590521214218071160287665180751)

for x in range(1, e):
    if(e*dp%x==1):
        p=(e*dp-1)//x+1
        if(n%p!=0):
            continue
        q=n//p
        phin=(p-1)*(q-1)
        d=gp.invert(e, phin)
        m=gp.powmod(c, d, n)
        if(len(hex(m)[2:])%2==1):
            continue
        print('--------------')
        print(m)
        print(hex(m)[2:])
        print(bytes.fromhex(hex(m)[2:])) 
```

ç»“æœï¼š
![Augenstern](img/8c719d2d0f7fc516df3339d90e44e947.png)

## RSA3

![Augenstern](img/978f771712776c69ee6ecbb4dd14cbd9.png)
å·²çŸ¥c1ã€c2ã€e1ã€e1ã€n çš„æƒ…å†µ

```
from gmpy2 import *
import libnum

n=22708078815885011462462049064339185898712439277226831073457888403129378547350292420267016551819052430779004755846649044001024141485283286483130702616057274698473611149508798869706347501931583117632710700787228016480127677393649929530416598686027354216422565934459015161927613607902831542857977859612596282353679327773303727004407262197231586324599181983572622404590354084541788062262164510140605868122410388090174420147752408554129789760902300898046273909007852818474030770699647647363015102118956737673941354217692696044969695308506436573142565573487583507037356944848039864382339216266670673567488871508925311154801
e1=11187289
e2=9647291
s = gcdext(e1, e2)
s1 = s[1]
s2 = -s[2]

c1=22322035275663237041646893770451933509324701913484303338076210603542612758956262869640822486470121149424485571361007421293675516338822195280313794991136048140918842471219840263536338886250492682739436410013436651161720725855484866690084788721349555662019879081501113222996123305533009325964377798892703161521852805956811219563883312896330156298621674684353919547558127920925706842808914762199011054955816534977675267395009575347820387073483928425066536361482774892370969520740304287456555508933372782327506569010772537497541764311429052216291198932092617792645253901478910801592878203564861118912045464959832566051361
c2=18702010045187015556548691642394982835669262147230212731309938675226458555210425972429418449273410535387985931036711854265623905066805665751803269106880746769003478900791099590239513925449748814075904017471585572848473556490565450062664706449128415834787961947266259789785962922238701134079720414228414066193071495304612341052987455615930023536823801499269773357186087452747500840640419365011554421183037505653461286732740983702740822671148045619497667184586123657285604061875653909567822328914065337797733444640351518775487649819978262363617265797982843179630888729407238496650987720428708217115257989007867331698397
e2=9647291
c2 = invert(c2, n)
m = (pow(c1,s1,n) * pow(c2 , s2 , n)) % n
print (m)
print (libnum.n2s(m)) 
```

ç»“æœï¼š
![Augenstern](img/7aeea31de55676b9cc0988c4b1cdd1db.png)

## RSA

![Augenstern](img/e80ed104ae5831d0d1c3f90198181fd5.png)
æ‰“å¼€å‹ç¼©åŒ…ï¼Œæ˜¯ä¸¤ä¸ªæ–‡ä»¶
![Augenstern](img/77da29839bb93cd49cc4b29f1beae148.png)
æ‰“å¼€è¿™ä¸ªæ–‡ä»¶(txtæ‰“å¼€æˆ–è€…notepad++)
å‘ç°äº†å…¬é’¥
![Augenstern](img/3d695b78d283702021c24e82ba6d68b9.png)
åœ¨çº¿è§£æå…¬é’¥çš„ç½‘ç«™ç›´æ¥è§£æå‡ºæˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯[åœ¨çº¿è§£æå…¬é’¥](https://www.ssleye.com/pub_asysi.html)
![Augenstern](img/2a0c97e2d9382a914f64647347ba1d04.png)
å¾—åˆ°nå’Œe
åˆ†è§£nå¾—åˆ°på’Œq ,å¯ä»¥ä½¿ç”¨yafuå› æ•°åˆ†è§£å¤§æ•°
![Augenstern](img/948b627ae01c02d08023b875a37fb067.png)
ä¹Ÿå¯ä»¥åœ¨çº¿ç½‘ç«™åˆ†è§£ï¼Œè¿™ä¸ªè¿˜ä¸ç®—å¤§æ•°ï¼Œå¦‚æœç‰¹åˆ«å¤§çš„æ•°è¿˜æ˜¯yafu æ¯”è¾ƒå¥½ç”¨å•¦ã€‚
![Augenstern](img/958c1e82bc9999b82eb14794562f68ed.png)
æœ€åéƒ½èƒ½å¾—å‡ºç»“æœæ¥
è„šæœ¬ï¼š

```
import gmpy2
import rsa

p = 285960468890451637935629440372639283459
q = 304008741604601924494328155975272418463
e = 65537
n = 86934482296048119190666062003494800588905656017203025617216654058378322103517

d = gmpy2.invert(e,(q-1)*(p-1))
print(d)

d = 81176168860169991027846870170527607562179635470395365333547868786951080991441

key = rsa.PrivateKey(n,e,d,p,q)
print(key)

with open("flag.enc","rb") as f:
	print(rsa.decrypt(f.read(),key).decode()) 
```

è¿è¡Œç»“æœï¼š
![Augenstern](img/52bbbaad79750edbb99ae4438b197009.png)
è¿‡ç¨‹ä¸­é‡åˆ°çš„é”™è¯¯ï¼š
åŸæœ¬æˆ‘æ˜¯åœ¨pycharmé‡Œè·‘è„šæœ¬ï¼Œä½†æ˜¯è·‘è¿™ä¸ªè„šæœ¬çš„æ—¶å€™ æŠ¥é”™äº†ã€‚æŠ¥é”™ä¿¡æ¯æ˜¯è¿™æ ·çš„ã€‚
`AttributeError: module 'rsa' has no attribute 'PrivateKey'`
![Augenstern](img/e574d0475c32a68b96cd9e611f22f868.png)
è¿™ç§æŠ¥é”™æ¯«æ— å¤´ç»ªï¼Œç™¾åº¦æ‰¾ä¸åˆ°ç±»ä¼¼çš„é”™è¯¯ï¼Œç„¶åæˆ‘æ€€ç–‘è„šæœ¬çš„é—®é¢˜ï¼Œç„¶ååˆæ‰¾æ‰¾å…¶ä»–çš„è„šæœ¬ï¼Œä½†æ˜¯å‘ç°æŠ¥é”™ä¿¡æ¯å·®ä¸å¤šï¼Œéƒ½æ˜¯è¿™ä¸ªåœ°æ–¹ã€‚æƒ³èµ·æ¥æˆ‘ç”µè„‘ä¸Šè¿˜å®‰è£…äº†ipythonï¼Œäºæ˜¯å°±è¯•è¯•ï¼Œä½†æ˜¯ä¹Ÿè·‘ä¸å‡ºæ¥ã€‚å°±å»é—®äº†é—®å­¦é•¿ã€‚å­¦é•¿è¯´åœ¨kalié‡Œé¢è¯•è¯•ã€‚è¿™ä¸ªæˆ‘è¿˜æ²¡è¯•ï¼Œå› ä¸ºé‚£é‡Œé¢è¿˜æ²¡å®‰è£…gmpy2è¿™ä¸ªåº“ã€‚æ˜å¤©å†å®‰è£…ã€‚è¿™æœŸé—´æˆ‘å‘ç°é”™è¯¯å°±æ˜¯è·¯å¾„çš„é—®é¢˜ã€‚å€’æ•°ç¬¬äºŒè¡Œä»£ç ï¼Œæ‰“å¼€æ–‡ä»¶`flag.enc`è¿™ä¸ªæ–‡ä»¶ï¼Œè¦æ·»åŠ è·¯å¾„ï¼Œè·¯å¾„ä¸­åŸæœ¬çš„`\`åœ¨è¿™é‡Œä½¿ç”¨`\\`å› ä¸ºè½¬ä¹‰ã€‚æˆ‘äºæ˜¯åˆåœ¨pycharmé‡Œè·‘äº†ä¸€æ¬¡ï¼Œä½†æ˜¯æ²¡æœ‰ç»“æœï¼ŒåŒæ ·çš„é”™è¯¯ã€‚
**é‡ç‚¹**ï¼šæˆ‘åœ¨ipythonä¸­è¯•äº†ä¸€ä¸‹ï¼Œç»“æœæƒŠå–œæ¥äº†ï¼ŒæˆåŠŸäº†ã€‚å°±å¾—åˆ°äº†ä¸Šé¢çš„è¿è¡Œç»“æœã€‚
å›å¤´kaliå®‰è£…å¥½gmpy2è¿™ä¸ªåº“ä¹‹åæˆ‘å†è¯•è¯•è¿™ä¸ªé¢˜ã€‚
æˆ‘è¿˜ä»¥ä¸ºè¿™ç¯‡åšå®¢çœŸçš„è¦æˆä¸ºä¸€ç¯‡çº¯ç²¹æ”¶é›†è„šæœ¬çš„æ–‡ç« äº†å‘¢ã€‚è¿˜æ˜¯æœ‰è‡ªå·±çš„æ”¶è·çš„ã€‚